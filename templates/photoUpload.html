{% extends "base.html" %}
{% block header %}
{% endblock %}
{% block body %}
<div class="pure-g-r">
  <div id="galleryHeader">
    <div class="pure-u-1-3">
      <h1>Photos and Text</h1>
    </div>
  </div>
</div>
<div class="pure-g-r">
  <div class="pure-u-1">
    <div id="dropbox">
      <p>Drop photos here.</p>
    </div>
  </div>
</div>
<div class="pure-g-r">
  <div class="pure-u-1">
    <div id="previewBox">
    </div>
  </div>
</div>
<div id="stickyFooter" class="pure-g-r">
  <div class="pure-u-1-4">
    <div class="counts">
      Uploading photo <span id="done">1</span> of <span id="count"></span>
    </div>
  </div>
  <div class="pure-u-1-2">
    <div id="galleryInfo" class="galleryHeaderSection">
      <input type="text" placeholder="Would you like to give this gallery a name?"></input>
    </div>
  </div>
  <div class="pure-u-1-4">
    <div id="galleryButtons">
      <select>
        <option value="private">Private</option>
        <option value="public">Public</option>
      </select>
      <button>Submit</button>
    </div>
  </div>
</div>
{% endblock %}
{% block javascript %}
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="{{ url_for('static',filename='js/jquery.fileupload.js') }}"></script>
<script>

$(document).ready(function() {
       var done = 0;
       $('#dropbox').fileupload({
        url: "{{ url_for('api_photo_list') }}",
        dropZone: $("#dropbox"),
        drop: function (e, data) {
          var count = 0;
          $("#stickyFooter").show();
          $("#dropbox").hide();
          $("#galleryInfo").show();
          $.each(data.files, function (index, file) {
              count = count + 1;
              $("#count").text(count);
              console.log('Dropped file: ' + file.name);
              $("#previewBox").prepend('<div id='+file.name+' class="pure-u-1-6"><div class="progress"><p class="bar"></p></div></div>');

          });
        },
        done: function (e, data) {
            $.each(data.result.results, function (index, result) {
              done = done +1;
              console.log(result.filename);
              $("div[id='"+result.filename+"'] .progress").hide();
              $("div[id='"+result.filename+"']").append('<img id='+result.id+' src='+(result.crops.thumb200)+'/>');
              $("#done").text(done);
            });
        },
        progress: function (e, data) {
          console.log(data);
          var progress = parseInt(data.loaded / data.total * 100, 10);
          $.each(data.files, function (index, file) {
            console.log(file.name);
            $("div[id='"+file.name+"'] .progress .bar").css(
              'width',
              progress + '%'
          );
          });
        },
        dragover: function(e, data) {
          $("#dropbox").css("background","#ccc");
        }
    });
    $('#dropbox').on('dragleave', function (e) {
      $("#dropbox").css("background","#eee");
    });
});
</script>
{% endblock %}